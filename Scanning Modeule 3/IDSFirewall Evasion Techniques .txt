IDS/Firewall Evasion Techniques :

- Although firewalls and IDS can prevent malicious traffic (packets) from entering a network, attackers can send intended packets to the target that evade the IDS/firewall by implementing the following techniques:

Packet Fragmentation
Source Routing
Source Port Manipulation
IP Address Decoy
IP Address Spoofing
MAC Address Spoofing
Creating Custom Packets
Randomizing Host Order
Sending Bad Checksums
Proxy Servers
Anonymizers

Packet Fragmentation :

- Packet fragmentation refers to the splitting of a probe packet into several smaller packets (fragments) while sending it to a network
- It is not a new scanning method but a modification of the previous techniques
- The TCP header is split into several packets so that the packet filters are not able to detect what the packets are intended to do

SYN/FIN Scanning Using IP Fragments :

SYN/FIN scanning using IP fragments is a modification of previous techniques to avoid false positives generated by packet filtering devices. The TCP header splits into several packets to evade the packet filter, and the initialized flags in the next packet allow the remote host to reassemble the packets upon receipt. The Internet protocol module detects the fragmented data packets using field-equivalent values of the source, destination, protocol, and identification.

<image>

The system splits the TCP header into fragments and transmits them over the network, but IP reassembly on the server side may result in unpredictable and abnormal results. This can lead to crashes, reboots, or network device monitoring dumps.

Firewalls may block IP fragmentation queues in the kernel, but this is not widely implemented due to its adverse effects on performance. Attackers use the SYN/FIN scanning method with IP fragmentation to evade packet filtering and detection, resulting in a high probability of causing problems on the target network.

<image>

Source Routing :

- As the packet travels through the nodes in the network, each router examines the destination IP address and chooses the next hop to direct the packet to the destination
- Source routing refers to sending a packet to the intended destination with a partially or completely specified route (without firewall-/IDS-configured routers) in order to evade an IDS or firewall
- In source routing, the attacker makes some or all of these decisions on the router

<image>

Source Port Manipulation :

- Source port manipulation refers to manipulating actual port numbers with common port numbers in order to evade an IDS or firewall
- It occurs when a firewall is configured to allow packets from well-known ports like HTTP, DNS, FTP, etc.
- Nmap uses the -g or -source-port options to perform source port manipulation

<image>


IP Address Decoy :

- IP address decoy technique refers to generating or manually specifying the IP addresses of decoys in order to evade an IDS or firewall
- It appears to the target that the decoys as well as the host(s) are scanning the network
- This technique makes it difficult for the IDS or firewall to determine which IP address was actually scanning the network and which IP addresses were decoys

Decoy Scanning using Nmap :

Nmap has two options for decoy scanning :

- nmap -D RND:10 [target] (Generates a random number of decoys)

nmap -D RND: 10 192.168.0.2

<image>

- nmap -D decoyl, decoy2, decoy3,.. etc. (Manually specify the IP addresses of the decoys)

For example, assume that 10.10.1.19 is the real source IP and 10.10.1.11 is the target IP address to be scanned. Then, the Nmap decoy command will be:

Syntax:
nmap -D 192.168.0.1, 172.120.2.8, 192.168.2.8, 10.10.1.19, 10.1.5.10, 10.10.1.11
<image>

- These decoys can be generated in both initial ping scans such as ICMP, SYN, ACK, etc., and during the actual port scanning phase. 
- IP address decoy is a useful technique for hiding your IP address. However, it will not be successful if the target employs active mechanisms such as router path tracing, response dropping, etc. Moreover, using many decoys can slow down the scanning process and affect the accuracy of the scan.

IP Address Spoofing :

- IP spoofing refers to changing the source IP addresses so that the attack appears to be coming from someone else
- When the victim replies to the address, it goes back to the spoofed address rather than the attacker's real address
- Attackers modify the address information in the IP packet header and the source address bits field in order to bypass the IDS or firewall

IP spoofing using Hping3 :

Hping3 www.certifiedhacker.com -a 7.7.7.7

<image>

Note: You will not be able to complete the three-way handshake and open a successful TCP connection with spoofed IP addresses

MAC Address Spoofing :

Network firewalls filter packets based on the source media access control (MAC) address. To avoid these restrictions, attackers use MAC spoofing techniques, which use fake MAC addresses and masquerade as legitimate users to scan the hosts behind the firewall. Attackers use the Nmap tool to evade firewalls via MAC address spoofing.

Performing MAC Address Spoofing to Scan Beyond IDS and Firewall Using Nmap:

Attackers use the --spoof-mac Nmap option to choose or set a specific MAC address for packets and send them to the target system/network.

nmap -ST-Pn --spoof-mac 0 [Target IP]

The -spoof-mac 0 command generates a random MAC address to be used when performing host scanning

<image>

nmap -ST-Pn --spoof-mac [Vendor] [Target IP]

Attackers can use the --spoof-mac command to spoof a MAC address from a vendor, allowing them to scan in hidden mode.

<image>

nmap -ST-Pn --spoof-mac [new MAC] [Target IP]

Attackers can manually set the MAC address for packets sent during scanning.

<image>

Creating Custom Packets :

- Attackers create custom TCP packets to scan the target by bypassing the firewall. 
- Attackers use various packet crafting tools such as Colasoft packet builder ( https://www.colasoft.com), NetScanTools Pro(https://www.netscantools.com), etc., to scan the target that is beyond the firewall. Packet crafting tools craft and send packet streams(custom packets)using diffferent protocols at different transfer rates.

<link>

Randomizing Host Order and sending Bad Checksums


Randomizing Host Order :

The attacker uses a technique called --randomize-hosts to scan the target network in a random order. This technique instructs Nmap to shuffle each group of 16384 hosts before scanning with slow timing options, making the scan less notable to network monitoring systems and firewalls. If larger group sizes are randomized, the PING GROUP_SZ should be increased in nmap. Another method is to generate the target IP list with a Perl script and provide it to Nmap using the -il command.

<image>

Sending Bad Checksums : 

The attacker sends packets with bad or bogus TCP/UPD checksums to the intended target to avoid certain firewall rule sets. This technique instructs Nmap to send packets with invalid TCP, UDP, or SCTP checksums. The option used by Nmap is --badsum. If there is no response or the packets are dropped, it can be inferred that the system is configured.

<image>

Proxy Servers :

- A proxy server is an application that can serve as an intermediary for connecting with other computers

A proxy server is used:
- As a firewall and to protect the local networking from external attacks.
- As an IP address multiplexer that allows several computers to connect to the Internet when you have only one IP address (NAT/PAT).
- To anonymize web surfing (to some extent).
- To extract unwanted content, such as ads or "unsuitable" material (using specialized proxy servers).
- To provide some protection against hacking attacks.
- To save bandwidth


How does a proxy server work?
- When using a proxy to request a web page on an actual server, the proxy server receives the request and mediates between the client and the destination application. To take advantage of a proxy server, an attacker must configure client programs to send their requests to the proxy server instead of the final destination.

<image>

Why Attackers Use Proxy Severs?
- It is easier for an attacker to attack or hack a particular system than to conceal the attack source.
- Thus, the attacker uses a proxy server to avoid attack detection by masking his/her IP address.
- When the attacker uses a proxy to connect to the target system, the server logs will record the proxy's source address rather than the attacker's source address.
- Proxy sites help the attacker to browse the Internet anonymously and access blocked sites (i.e., evade firewall restrictions).

<image>

Attackers use proxy servers:

- To hide the actual source of a scan and evade certain IDS/firewall restrictions.
- To hide the source IP address so that they can hack without any legal corollary.
- To mask the actual source of the attack by employing a fake source address of the proxy. 
- To remotely access intranets and other website resources that are normally off limits.
- To interrupt all the requests sent by a user and transmit them to a third destination; hence, victims will only be able to identify the proxy server address.
- To chain multiple proxy servers to avoid detection.

Proxy Chaining :

Proxy chaining helps an attacker to increase his/her Internet anonymity. Internet anonymity depends on the number of proxies used for fetching the target application; the larger the number of proxy servers used, the greater is the attacker's anonymity.

The proxy chaining process is described below:
- The user requests a resource from the destination.
- A proxy client in the user's system connects to a proxy server and passes the request to the proxy server.
- The proxy server strips the user's identification information and passes the request to the next proxy server.
- This process is repeated by all the proxy servers in the chain.
- Finally, the unencrypted request is passed to the web server.

< image >

Anonymizers

- An anonymizer is an intermediate server placed between an end user and a website that accesses the website on their behalf and makes web surfing activities untraceable. It encrypts the data transferred from a computer to the Internet service provider (ISP) and can anonymize web, FTP, and gopher Internet services. 
- To visit a page anonymously, users can visit their preferred anonymizer site and enter the name of the target website in the anonymization field. Attackers may configure an anonymizer as a permanent proxy server by making the site name the setting for the HTTP, FTP, Gopher, and other proxy options in their application configuration menu.


Why Use an Anonymizer?

The reasons for using anonymizers include:

- Ensure privacy : by making web navigation activities untraceable and disclosing personal information.
- Accessing Government-restricted content:  can still be accessed using an anonymizer located outside the target country.
- Protection against online attacks: Anonymizers can protect against online pharming attacks by routing customer Internet traffic through a protected DNS server.
- Bypassing IDS and firewall rules:Firewalls are typically bypassed by employees or students accessing websites that they are not supposed to access. An anonymizer service sets up a connection between your computer and the anonymizer service, allowing firewalls to see only the connection from your computer to the anonymizer's web address. The anonymizer will then connect to any website with an Internet connection and direct the content back to you.

In addition to protecting users' identities, anonymizers can also be used to attack a website without being traced.

Types of Anonymizers

Anonymizers are of two basic types: networked anonymizers and single-point anonymizers

- Networked Anonymizers :

Networked anonymizers transfer information through a network of Internet-connected computers, making it difficult for anyone to track it.
Example: If you want to visit any web page, you have to make a request. The request will first pass through A, B, and C Internet computers before going to the website.

Advantage: Complication of the communications makes traffic analysis complex. 
Disadvantage: Any multi-node network communication incurs some degree of risk of compromising confidentiality at each node

- Single-Point Anonymizers

Single-point anonymizers first transfer your information through a website before sending it to the target website and then pass back the information gathered from the target website to you via the website to protect your identity. 

Advantage: Arms-length communication hides the IP address and related identifying information.

Disadvantage: It offers less resistance to sophisticated traffic analysis.



































